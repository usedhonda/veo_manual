# Ingredients モード

## 概要

参照画像を使ってキャラクターや要素の一貫性を保ちながら動画を生成するモード。

**いつ使う？**
- 同じキャラクターを複数シーンで使いたい
- アニメキャラクターの一貫性が必要
- 特定の被写体を正確に再現したい

---

## Ingredientsモードの仕組み

```
┌─────────────────────────────────────────────────────────────┐
│ Ingredients モードの動作                                     │
│                                                             │
│  参照画像（最大3枚）                                        │
│       ↓                                                     │
│  Veo 3.1が特徴を学習                                        │
│       ↓                                                     │
│  プロンプトに基づいて動画生成                               │
│       ↓                                                     │
│  参照画像の特徴を維持した出力                               │
└─────────────────────────────────────────────────────────────┘
```

### 重要な制約（Veo 3.1）

```
【制約事項】
- referenceType: "asset" のみ
- "style" タイプは非対応
- 最大3枚まで

【これが意味すること】
- スタイル転写はできない
- キャラクター/オブジェクトの参照のみ
- 厳選した参照画像が必要
```

---

## 基本的なワークフロー

```
┌─────────────────────────────────────────────────────────────┐
│ Ingredients ワークフロー                                     │
│                                                             │
│  1. Nano Banana Pro でキャラクターシートを生成              │
│                         ↓                                   │
│  2. 参照画像として指定（referenceType: "asset"）            │
│                         ↓                                   │
│  3. シーンプロンプトでキャラを使用                          │
│                         ↓                                   │
│  4. 毎回キャラの特徴を再記述（補強）                        │
└─────────────────────────────────────────────────────────────┘
```

---

## Geminiへの依頼テンプレート

### 基本テンプレート

```
Veo 3.1のIngredientsモード用プロンプトを生成してください。

【参照画像】
- 内容: [キャラクターシートの説明]
- 特徴: [キャラの主な特徴]

【シーン】
- ロケーション: [場所]
- アクション: [何をしているか]
- カメラ: [ショットタイプ、動き]
- 雰囲気: [ムード]

【一貫性の維持】
必ず維持する要素:
- [特徴1]
- [特徴2]
- [特徴3]

【スタイル】
- メディウム: anime
- サブスタイル: [詳細なスタイル]

【オーディオ】
- 台詞: [あれば]
- SE: [効果音]
- BGM: [音楽]
```

---

## 具体的な依頼例

### 例1: キャラクター紹介シーン

```
Ingredientsでキャラ紹介動画を生成

【参照画像】
- キャラクターシート（正面、45度、横顔）
- ターコイズツインテール、セーラー服

【シーン】
- 場所: 学校の屋上、夕日
- アクション: 風を受けて立っている
- カメラ: ローアングルからクレーンアップ
- 表情: 決意を秘めた笑顔

【一貫性】
維持する要素:
- ターコイズブルーの髪色
- ツインテール + 黒リボン
- セーラー服（白、紺、赤リボン）
- ターコイズの瞳

【スタイル】
- medium: anime
- sub_style: modern anime, cel-shaded

【オーディオ】
- SE: 風の音、髪がなびく音
- BGM: オーケストラ、希望に満ちた
```

### 例2: アクションシーン

```
Ingredientsでアクション動画を生成

【参照画像】
- 同じキャラクターシート

【シーン】
- 場所: 学校の廊下
- アクション: 全力で走る
- カメラ: サイドからのトラッキング
- 表情: 必死、焦り

【一貫性】
維持する要素:
- 同上（キャラ特徴すべて）
- 服装も同じ

【スタイル】
- medium: anime
- sub_style: dynamic anime, action-oriented

【オーディオ】
- SE: 足音、息遣い
- BGM: テンポの速いBGM
```

### 例3: 感情的な会話シーン

```
Ingredientsで会話シーンを生成

【参照画像】
- 同じキャラクターシート

【シーン】
- 場所: 夕暮れの教室
- アクション: 話している、手を動かす
- カメラ: ミディアムショット、静止
- 表情: 真剣、少し悲しげ

【一貫性】
維持する要素:
- 同上（キャラ特徴すべて）

【スタイル】
- medium: anime
- sub_style: emotional, slice of life

【オーディオ】
- 台詞: 「ずっと...ずっと言いたかったの」
- BGM: なし、環境音のみ
```

---

## 参照画像の指定方法

### API形式

```json
{
  "referenceImages": [
    {
      "referenceType": "asset",
      "image": {
        "gcsUri": "gs://bucket/character-sheet.png"
      }
    }
  ]
}
```

### 複数画像の場合

```json
{
  "referenceImages": [
    {
      "referenceType": "asset",
      "image": {
        "gcsUri": "gs://bucket/character-front.png"
      }
    },
    {
      "referenceType": "asset",
      "image": {
        "gcsUri": "gs://bucket/character-side.png"
      }
    }
  ]
}
```

---

## 一貫性を保つ秘訣

### 1. 参照画像の品質

```
【良い参照画像】
- 複数アングルを含む
- 背景がシンプル
- 特徴が明確に見える
- 高解像度

【悪い参照画像】
- 単一アングルのみ
- 複雑な背景
- 特徴が不明瞭
- 低解像度、ぼやけ
```

### 2. プロンプトでの補強

```
【毎回含める】
"Using the character from reference image:
[詳細な特徴を列挙]"

【例】
"Using the character from reference:
- turquoise blue twin-tail hair tied with black ribbons
- turquoise blue eyes
- sailor uniform: white blouse, navy pleated skirt, red ribbon tie
- black knee-high socks"
```

### 3. ネガティブプロンプト

```json
{
  "negative": {
    "exclude": [
      "off-model",
      "different hairstyle",
      "wrong hair color",
      "costume change",
      "different outfit",
      "inconsistent design",
      "realistic",
      "photorealistic",
      "3D render"
    ]
  }
}
```

### 4. スタイルの固定

```json
{
  "style": {
    "medium": "anime",
    "sub_style": "modern anime, cel-shaded, 2D animation",
    "consistency": "Match character design from reference exactly"
  }
}
```

---

## 複数キャラクターの場合

### 制約

```
- 参照画像は最大3枚
- 複数キャラを1枚にまとめるか
- 優先度の高いキャラのみ参照を使用
```

### 対策

```
【方法1】キャラクターシートに複数キャラ
1枚のシートに複数キャラを配置
プロンプトで「Character A (left)」「Character B (right)」と参照

【方法2】優先度で選択
メインキャラのみ参照画像を使用
サブキャラはプロンプトのみで記述

【方法3】シーン分割
キャラごとに別シーンで生成
後から編集で組み合わせ
```

---

## トラブルシューティング

### 問題: キャラが変わる

```
【症状】
- 髪の色が違う
- 服装が変わる
- 顔が別人

【対策】
1. 参照画像の品質を確認
2. プロンプトで特徴を毎回再記述
3. ネガティブに「off-model」追加
4. より詳細な特徴記述
```

### 問題: スタイルが変わる

```
【症状】
- アニメ風でなくなる
- 3Dっぽくなる
- リアル調になる

【対策】
1. スタイルを強く指定
2. ネガティブに「realistic」「3D render」追加
3. 「2D animation」「cel-shaded」を追加
```

### 問題: 参照が効いていない

```
【症状】
- 参照画像と全く違うキャラ
- 特徴が反映されない

【対策】
1. referenceType が "asset" か確認
2. 画像の品質を確認
3. プロンプトで「Using character from reference」を明記
4. より単純なシーンから試す
```

---

## ワークフロー例：MV制作

```
┌─────────────────────────────────────────────────────────────┐
│ MV用キャラアニメのワークフロー                              │
│                                                             │
│  1. Nano Banana Pro でキャラクターシート生成                │
│                         ↓                                   │
│  2. シーン1: キャラ紹介（Ingredients）                      │
│                         ↓                                   │
│  3. シーン2: サビの歌唱（同じ参照画像）                     │
│                         ↓                                   │
│  4. シーン3: ダンス（同じ参照画像）                         │
│                         ↓                                   │
│  5. 編集ソフトで結合                                        │
└─────────────────────────────────────────────────────────────┘
```

---

## 次に読む

- **キャラ設計の詳細**: `../phase1-image/02-character-sheet.md`
- **アニメMVを作りたい**: `../use-cases/anime-character.md`
- **MVを作りたい**: `../use-cases/music-video.md`
